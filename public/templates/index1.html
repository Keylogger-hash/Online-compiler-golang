<!DOCTYPE html>
<html>
    <head>
  
        <link href="/static/css/base.css" rel="stylesheet">
    </head>
    <body>
        <div >
            <header>
                <nav>
                  <ul>
                    <li><a href="/index1"><img width="82" height="32" src="static/images/go-logo-white.svg"></a></li>
                    <li><a href="/">Why go</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Terms of service</a></li>
                    <li><a href="#">Contact</a></li>
                  </ul>
              </header>
            <!-- <div class="header">
                <h2>Online compiler golang</h2>
            </div> -->
            <div class="split left">
                <!-- <h2>Code</h2> -->
                <p></p>
                <div style="display:inline-block; padding-bottom: 1em;">
                    <button id="run-code" style="align-items: center;
                    background-color: #ffffdd;;
                    border: none;
                    border-radius: 0.1875rem;
                    box-shadow: 0 2px 5px rgb(0 0 0 / 20%);
                    box-sizing: border-box;
                    color: #007d9c;
                    cursor: pointer;
                    display: inline-flex;
                    font: bold 0.875rem Roboto, sans-serif;
                    height: 1.75rem;
                    padding: 0 0.625rem;
                    justify-content: center;
                    min-width: 4.063rem;
                    text-decoration: none;">Run</button>
                    <button id="format-code" style="align-items: center;
                    background-color: #ffffdd;;
                    border: none;
                    border-radius: 0.1875rem;
                    box-shadow: 0 2px 5px rgb(0 0 0 / 20%);
                    box-sizing: border-box;
                    color: #007d9c;
                    cursor: pointer;
                    display: inline-flex;
                    font: bold 0.875rem Roboto, sans-serif;
                    height: 1.75rem;
                    padding: 0 0.625rem;
                    justify-content: center;
                    min-width: 4.063rem;
                    text-decoration: none;">Format</button>
                     <button id="open-code" style="align-items: center;
                     background-color: #ffffdd;;
                     border: none;
                     border-radius: 0.1875rem;
                     box-shadow: 0 2px 5px rgb(0 0 0 / 20%);
                     box-sizing: border-box;
                     color: #007d9c;
                     cursor: pointer;
                     display: inline-flex;
                     font: bold 0.875rem Roboto, sans-serif;
                     height: 1.75rem;
                     padding: 0 0.625rem;
                     justify-content: center;
                     min-width: 4.063rem;
                     text-decoration: none;" type="file">Open</button>
                    <button style="align-items: center;
                    background-color: #ffffdd;;
                    border: none;
                    border-radius: 0.1875rem;
                    box-shadow: 0 2px 5px rgb(0 0 0 / 20%);
                    box-sizing: border-box;
                    color: #007d9c;
                    cursor: pointer;
                    display: inline-flex;
                    font: bold 0.875rem Roboto, sans-serif;
                    height: 1.75rem;
                    padding: 0 0.625rem;
                    justify-content: center;
                    min-width: 4.063rem;
                    text-decoration: none;" >Share</button>
                </div>
                <div id="editor" style="height: 86%; width: 90%"></div>
                </div>
              </div>              
              <div class="split right">
                <!-- <h2>Output</h2> -->
                <p></p>
                <p style="height:1.75rem; padding:0 0.625rem;"></p>
                <div style="width:96%;height:83.5%;background-color: #ffffdd;border: solid #5B6DCD 3px; padding: 5px;box-sizing: content-box;">
                    <pre>
                        <span ><p class="stdout" id="stdout">Hello world!</p></span>
                        <span ><p class="stderr" id="stderr">Program exited.</p></span>
                    </pre>
                </div>

                </textarea>
                <!-- <div id="editor1" style="height:86%;width:100%;">
                    
                </div> -->
                </div>
              </div>
        </div>
        
        <script src="/static/js/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="/static/js/ace-builds/src-noconflict/ext-language_tools.js"></script>
        <script src="/static/js/ace-builds/src-noconflict/snippets/golang.js"></script>
        <script src="static/js/ace-builds/src-noconflict/mode-golang.js"></script>

        <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.setOptions({
                enableLiveAutocompletion: true,
                enableSnippets: true,
                enableBasicAutocompletion: true
            })
            editor.session.setMode("ace/mode/golang");
            
            var buttonFormatCode = document.querySelector("#format-code")
            var buttonRunCode = document.querySelector("#run-code")
            var buttonOpenCode = document.querySelector("#open-code")
            buttonOpenCode.onclick = function(){
                
            }
            buttonRunCode.onclick = function(){
                var text = editor.session.getValue();
                var stderr = document.querySelectorAll("p.stderr")[0];
                var stdout = document.querySelectorAll("p.stdout")[0];

                var data = {
                    Body:text
                }
                var Data = {
                    headers: {
                        "Content-type":"application/json",
                    },
                    body:JSON.stringify(data),
                    method:"POST"
                }
                stdout.textContent = "Waiting remote server ..."
                fetch("/compile",Data).then(response => response.json()).then((data) => {
                    console.log(data)
                    if (data["Error"] !== "" ){
                        stdout.textContent = data["Error"]
                        stderr.textContent = "Go build failed"
                    } else {
                        stdout.textContent = data["Res"]
                        editor.session.setValue(data["Body"],-1)
                        stderr.textContent = "Program exited."
                    }
                });
            }
            buttonFormatCode.onclick = function() {
                var text = editor.session.getValue();
                var data = {
                    Body:text
                }
                var Data = {
                    headers: {
                        "Content-type":"application/json",
                    },
                    body:JSON.stringify(data),
                    method:"POST"
                }
                fetch("/fmt",Data).then(response => response.json()).then((data) => {
                    console.log(data)
                    if (data["Error"] !== "" ){
                        var output = document.querySelectorAll("p.stderr")[0];
                        output.textContent = data["Error"]
                    } else {
                        editor.session.setValue(data["Body"],-1)
                    }
                });
            }

            
        </script>

    </body>
</html>
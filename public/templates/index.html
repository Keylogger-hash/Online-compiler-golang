<!DOCTYPE html>
<html>
    <head>
  
        <link href="/static/css/base.css" rel="stylesheet">
    </head>
    <body>
        <div >
            <header>
                <nav>
                  <ul>
                    <li><a href="/index1"><img width="82" height="32" src="static/images/go-logo-white.svg"></a></li>
                    <li><a href="/">Why go</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Terms of service</a></li>
                    <li><a href="/contacts">Contact</a></li>
                  </ul>
              </header>
            <div class="split left">
                <p></p>
                <div id="code-button-group" >
                    <button id="run-code" class="code-button" >Run</button>
                    <button id="format-code" class="code-button">Format</button>
                    <button id="open-code" class="code-button">Open</button>
                    <button id="download-code" class="code-button">Download</button>
                    <button id="share-code" class="code-button" >Share</button>
                </div>
                <div id="editor" ></div>
                </div>
              </div>              
              <div class="split right">
                <p></p>
                <p id="line-break" ></p>
                <div id="textbox" >
                    <pre>
                        <span ><p class="stdout" id="stdout" >Hello world!</p></span>
                        <span ><p class="stderr" id="stderr">Program exited.</p></span>
                    </pre>
                </div>
                <!-- </textarea> -->

                </div>
              </div>
              
        </div>
        <!-- <div id="footer">
            <p>This is the footer</p>
        </div> -->
        <script src="/static/js/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="/static/js/ace-builds/src-noconflict/ext-language_tools.js"></script>
        <script src="/static/js/ace-builds/src-noconflict/snippets/golang.js"></script>
        <script src="static/js/ace-builds/src-noconflict/mode-golang.js"></script>
        <script src="/static/js/main.js"></script>
        <!-- <script>
            var editor = ace.edit("editor");
            let input;
            var reader;
            editor.setTheme("ace/theme/monokai");
            editor.setOptions({
                enableLiveAutocompletion: true,
                enableSnippets: true,
                enableBasicAutocompletion: true
            })
            editor.session.setMode("ace/mode/golang");
            var buttonFormatCode = document.querySelector("#format-code")
            var buttonRunCode = document.querySelector("#run-code")
            var buttonOpenCode = document.querySelector("#open-code")
            var buttonDownloadCode = document.querySelector("#download-code")
            window.onbeforeunload = function(){
                text=editor.session.getValue()
                window.localStorage.setItem('text',text)
            }
            document.addEventListener('DOMContentLoaded',function(){
                text = window.localStorage.getItem('text')
                if (text) {
                    editor.session.setValue(text)
                }
            })
            buttonDownloadCode.onclick = function(){
                textValue = editor.getValue();
                file = new Blob([textValue])
                file.name=
                fileLink = document.createElement('a')
                url = URL.createObjectURL(file,{type:'.go'})
                fileLink.href=url;
                fileLink.download='main.go';
                document.body.appendChild(fileLink);
                fileLink.click()
                setTimeout(function(){
                   document.body.removeChild(fileLink) 
                   window.URL.revokeObjectURL(url);  
                },0)
            }
            buttonOpenCode.onclick = function(){
                console.log('open file')
                input=document.createElement('input');
                input.type='file'
                input.accept = ".go"
                input.onchange = _ => {
                    let file = Array.from(input.files)[0];
                    reader=new FileReader();
                    reader.onload = _ =>{
                        editor.session.setValue(reader.result);
                        console.log('Set session value');
                    }
                    if (file){
                        reader.readAsText(file);
                    }
                }
                input.click()
                
            }
            buttonRunCode.onclick = function(){
                var text = editor.session.getValue();
                var stderr = document.querySelectorAll("p.stderr")[0];
                var stdout = document.querySelectorAll("p.stdout")[0];

                var data = {
                    Body:text
                }
                var Data = {
                    headers: {
                        "Content-type":"application/json",
                    },
                    body:JSON.stringify(data),
                    method:"POST"
                }
                stdout.textContent = "Waiting remote server ..."
                fetch("/compile",Data).then(response => response.json()).then((data) => {
                    console.log(data)
                    if (data["Error"] !== "" ){
                        stdout.textContent = data["Error"]
                        stderr.textContent = "Go build failed"
                    } else {
                        stdout.textContent = data["Res"]
                        editor.session.setValue(data["Body"],-1)
                        stderr.textContent = "Program exited."
                    }
                });
            }
            buttonFormatCode.onclick = function() {
                var text = editor.session.getValue();
                var data = {
                    Body:text
                }
                var Data = {
                    headers: {
                        "Content-type":"application/json",
                    },
                    body:JSON.stringify(data),
                    method:"POST"
                }
                fetch("/fmt",Data).then(response => response.json()).then((data) => {
                    console.log(data)
                    if (data["Error"] !== "" ){
                        var output = document.querySelectorAll("p.stderr")[0];
                        output.textContent = data["Error"]
                    } else {
                        editor.session.setValue(data["Body"],-1)
                    }
                });
            }
        </script> -->
    </body>
</html>